function trackCertificateSelection(e,t,a){"undefined"!=typeof gtag&&gtag("event","select_certificate",{certificate_id:e,certificate_name:t,value:a,currency:"RUB"}),"undefined"!=typeof ym&&ym(YANDEX_METRIKA_ID,"reachGoal","select_certificate",{certificate_id:e,certificate_name:t,price:a})}function trackCertificateOrder(e,t){"undefined"!=typeof gtag&&gtag("event","purchase",{transaction_id:e,value:t,currency:"RUB",items:[{item_id:"certificate",item_name:"Gift Certificate",price:t,quantity:1}]}),"undefined"!=typeof ym&&ym(YANDEX_METRIKA_ID,"reachGoal","certificate_order",{order_id:e,amount:t})}!function(e){"use strict";var t={id:null,name:"",price:null};function a(t,a){var n=e("#"+t),i=n.siblings(".error-message");n.addClass("error"),i.length?i.text(a).addClass("show"):n.after('<div class="error-message show">'+a+"</div>")}function n(t){var a='<div class="alert alert-danger" role="alert"><strong>Ошибка!</strong> '+t+"</div>";e("#certificate-order-form").prepend(a),e(".mfp-content").animate({scrollTop:0},300)}function i(){e(".form-control").removeClass("error"),e(".error-message").removeClass("show"),e(".alert").remove()}function r(){e("#certificate-order-form")[0].reset(),i(),e(".type-option").removeClass("selected"),e(".type-option:first").addClass("selected").find("input").prop("checked",!0),e(".delivery-section").hide().removeClass("show"),e(".amount-btn").removeClass("selected"),e('#certificate-order-form button[type="submit"]').prop("disabled",!1).text("Оформить заказ"),e("#certificate-order-form .form-content").show()}e(document).ready(function(){e('a[href^="#"]').on("click",function(t){var a=e(this.getAttribute("href"));a.length&&(t.preventDefault(),e("html, body").stop().animate({scrollTop:a.offset().top-80},800,"swing"))}),e(".btn-select-certificate").on("click",function(t){t.preventDefault(),e("html, body").animate({scrollTop:e("#certificates-section").offset().top-80},800)}),e(".btn-how-it-works").on("click",function(t){t.preventDefault(),e("html, body").animate({scrollTop:e("#how-it-works").offset().top-80},800)}),e(".faq-question").on("click",function(){var t=e(this).closest(".faq-item"),a=t.find(".faq-answer"),n=t.hasClass("active");e(".faq-item").not(t).removeClass("active").find(".faq-answer").slideUp(300),n?(t.removeClass("active"),a.slideUp(300)):(t.addClass("active"),a.slideDown(300))}),window.selectCertificate=function(a,n,i){t={id:a,name:n,price:i},e("#modal-certificate-name").text(n),e("#certificate_id").val(a),e("#certificate_name").val(n),e("#amount").attr("min",i),e("#amount").val(i),e(".amount-btn").removeClass("selected"),e('.amount-btn[data-amount="'+i+'"]').addClass("selected"),e.magnificPopup.open({items:{src:"#buy_form",type:"inline"},callbacks:{open:function(){r()}}})},e("#certificate-order-form").on("submit",function(o){if(o.preventDefault(),i(),!function(){var n=!0,i=parseInt(e("#amount").val()),r=t.price||5e3;(!i||i<r)&&(a("amount","Минимальная сумма сертификата "+r+" рублей"),n=!1);var o=e("#firstname").val().trim();(!o||o.length<1||o.length>32)&&(a("firstname","Имя должно быть от 1 до 32 символов"),n=!1);var c=e("#email").val().trim(),s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;c&&s.test(c)||(a("email","Введите корректный E-Mail"),n=!1);var l=e("#telephone").val().trim();if((!l||l.length<6)&&(a("telephone","Введите корректный номер телефона"),n=!1),"1"===e('input[name="type"]:checked').val()){var d=e("#address").val().trim();(!d||d.length<10)&&(a("address","Введите полный адрес доставки"),n=!1)}return e("#agree").prop("checked")||(a("agree","Необходимо согласие с политикой конфиденциальности"),n=!1),n}())return!1;var c=e(this).find('button[type="submit"]');c.prop("disabled",!0).text("Отправка...");var s={certificate_id:e("#certificate_id").val(),certificate_name:e("#certificate_name").val(),amount:e("#amount").val(),type:e('input[name="type"]:checked').val(),firstname:e("#firstname").val(),lastname:e("#lastname").val(),email:e("#email").val(),telephone:e("#telephone").val(),wishes:e("#wishes").val(),comment:e("#comment").val(),agree:e("#agree").prop("checked")?1:0};return"1"===s.type&&(s.address=e("#address").val(),s.number=e("#number").val()),e.ajax({url:"index.php?route=information/certificates/order",type:"POST",data:s,dataType:"json",success:function(t){var i;t.error?(i=t.error,e.each(i,function(e,t){"warning"===e?n(t):a(e,t)}),c.prop("disabled",!1).text("Оформить заказ")):t.success&&(function(t){var a='<div class="alert alert-success" role="alert"><strong>Успешно!</strong> '+t.success+"<br>Номер заказа: <strong>#"+t.order_id+"</strong><br>Сейчас вы будете перенаправлены на страницу оплаты...</div>";e("#certificate-order-form").prepend(a),e("#certificate-order-form .form-content").slideUp(300),e(".mfp-content").animate({scrollTop:0},300)}(t),setTimeout(function(){t.payment_url?window.location.href=t.payment_url:(e.magnificPopup.close(),r())},2e3))},error:function(e,t,a){console.error("AJAX Error:",a),n("Произошла ошибка при отправке заказа. Попробуйте позже."),c.prop("disabled",!1).text("Оформить заказ")}}),!1}),e(".amount-btn").on("click",function(){var t=e(this).data("amount");e(".amount-btn").removeClass("selected"),e(this).addClass("selected"),e("#amount").val(t)}),e("#amount").on("input",function(){var t=e(this).val(),a=e('.amount-btn[data-amount="'+t+'"]');e(".amount-btn").removeClass("selected"),a.length&&a.addClass("selected")}),e(".type-option").on("click",function(){var t=e(this).find('input[type="radio"]'),a=t.val();e(".type-option").removeClass("selected"),e(this).addClass("selected"),t.prop("checked",!0),"1"===a?(e(".delivery-section").slideDown(300).addClass("show"),e("#address").prop("required",!0)):(e(".delivery-section").slideUp(300).removeClass("show"),e("#address").prop("required",!1))}),function(){if("IntersectionObserver"in window){var t=new IntersectionObserver(function(a){a.forEach(function(a){a.isIntersecting&&(e(a.target).addClass("fade-in"),t.unobserve(a.target))})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});e(".certificate-card, .step-card, .faq-item, .hero-feature").each(function(){t.observe(this)})}else e(".certificate-card, .step-card, .faq-item, .hero-feature").addClass("fade-in")}()}),e("#telephone").on("input",function(){var t=e(this).val().replace(/\D/g,"");if(t.length>0){var a=(t="7"===t[0]||"8"===t[0]?"+7"+t.slice(1):"+7"+t).slice(0,2);t.length>2&&(a+=" ("+t.slice(2,5)),t.length>5&&(a+=") "+t.slice(5,8)),t.length>8&&(a+="-"+t.slice(8,10)),t.length>10&&(a+="-"+t.slice(10,12)),e(this).val(a)}}),e("#amount").on("input",function(){var t=e(this).val().replace(/\D/g,"");e(this).val(t)});var o=!1;e("#certificate-order-form").on("submit",function(e){if(o)return e.preventDefault(),!1;o=!0,setTimeout(function(){o=!1},3e3)}),e(document).on("click",".mfp-close",function(){r()}),"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname||(console.log("Certificates JS loaded"),console.log("jQuery version:",e.fn.jquery))}(jQuery),function(e){e(document).ready(function(){void 0===e.magnificPopup?(console.error("Magnific Popup not loaded! Please include it in your template."),window.selectCertificate=function(e,t,a){alert("Для оформления заказа необходимо подключить библиотеку Magnific Popup.\n\nСертификат: "+t+"\nЦена: "+a+" ₽")}):(e.magnificPopup.instance.defaults.closeOnBgClick=!1,e.magnificPopup.instance.defaults.enableEscapeKey=!0,e.magnificPopup.instance.defaults.closeBtnInside=!0)})}(jQuery);